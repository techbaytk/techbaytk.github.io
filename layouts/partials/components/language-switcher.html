{{/*
layouts/partials/components/language-switcher.html
Fixed version with proper language handling
*/}}
{{- $currentPage := . -}}

<div class="lang-switcher-container">
    <details class="lang-switcher">
        <summary class="lang-switcher-summary">
            <span class="icon-globe">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-globe">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
                    <path d="M2 12h20" />
                </svg>
            </span>
            <span class="lang-initials">{{ $currentPage.Language.Lang | upper }}</span>
        </summary>
        <ul class="lang-dropdown">
            {{ range .Site.Home.AllTranslations }}
            {{ if ne .Language.Lang $currentPage.Language.Lang }}
            <li class="lang-option">
                <a href="{{ .Permalink }}" class="lang-link">{{ .Language.LanguageName }} ({{ .Language.Lang | upper
                    }})</a>
            </li>
            {{ end }}
            {{ end }}
        </ul>
    </details>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const langSwitcher = document.querySelector('.lang-switcher');
        
        if (langSwitcher) {
            // Toggle dropdown when clicking the summary
            langSwitcher.querySelector('summary').addEventListener('click', function(e) {
                e.preventDefault();
                langSwitcher.toggleAttribute('open');
            });
    
            // Keep dropdown open when clicking inside
            langSwitcher.querySelector('.lang-dropdown').addEventListener('click', function(e) {
                e.stopPropagation();
            });
    
            // Close when clicking outside
            document.addEventListener('click', function(e) {
                if (!langSwitcher.contains(e.target)) {
                    langSwitcher.removeAttribute('open');
                }
            });
        }
    });
    </script>